-- SQLite Database Schema
-- Generated by NL2SQL Designer
-- Database: {{ metadata.get('database_name', 'my_database') }}

{% if metadata.get('drop_existing', False) %}
-- Drop existing tables
{% for entity in entities %}
DROP TABLE IF EXISTS "{{ entity.name }}";
{% endfor %}

{% endif %}
-- Create tables
{% for entity in entities %}
CREATE TABLE "{{ entity.name }}" (
{% for attr in entity.attributes %}
    "{{ attr.name }}" {{ attr.data_type }}{% if attr.length and attr.data_type in ['VARCHAR', 'CHAR'] %}({{ attr.length }}){% endif %}{% if attr.is_primary_key %} PRIMARY KEY AUTOINCREMENT{% endif %}{% if not attr.is_nullable %} NOT NULL{% endif %}{% if attr.is_unique and not attr.is_primary_key %} UNIQUE{% endif %}{% if attr.default_value %} DEFAULT {{ attr.default_value }}{% endif %}{% if not loop.last %},{% endif %}

{% endfor %}
);

{% endfor %}

-- Create indexes for better performance
{% for entity in entities %}
{% for attr in entity.attributes %}
{% if attr.is_foreign_key and not attr.is_primary_key %}
CREATE INDEX "idx_{{ entity.name }}_{{ attr.name }}" ON "{{ entity.name }}"("{{ attr.name }}");
{% endif %}
{% endfor %}
{% endfor %}

-- End of SQLite schema
